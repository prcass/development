<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Know-It-All Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(to bottom, #2563eb, #7c3aed);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        .card {
            background: white;
            color: black;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .subtitle {
            font-size: 1.25rem;
            text-align: center;
            margin-bottom: 2rem;
            color: #666;
        }
        
        .camera-icon {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            font-size: 2rem;
        }
        
        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }
        
        .btn-purple {
            background: #7c3aed;
        }
        
        .btn-purple:hover {
            background: #6d28d9;
        }
        
        .btn-green {
            background: #059669;
        }
        
        .btn-green:hover {
            background: #047857;
        }
        
        .btn-red {
            background: #dc2626;
        }
        
        .btn-red:hover {
            background: #b91c1c;
        }
        
        .input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .grid {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .reveal-card {
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            transition: all 0.5s ease;
        }
        
        .reveal-card.unrevealed {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .reveal-card.current {
            background: #fef3c7;
            border-color: #f59e0b;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .reveal-card.revealed-correct {
            background: #dcfce7;
            border-color: #16a34a;
        }
        
        .reveal-card.revealed-blocked {
            background: #fee2e2;
            border-color: #dc2626;
        }
        
        .block-item {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .result-icon {
            font-size: 4rem;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-sm {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .font-bold {
            font-weight: bold;
        }
        
        .mb-4 {
            margin-bottom: 1rem;
        }
        
        .mb-6 {
            margin-bottom: 1.5rem;
        }
        
        .info-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Screen 1: QR Scanner -->
        <div id="screen1" class="screen active">
            <div class="text-center">
                <h1 class="title">Know-It-All</h1>
                <div class="camera-icon">üì∑</div>
                <p class="subtitle">Scan a prompt card to begin</p>
                <button class="btn" onclick="simulateQRScan()">üì∑ Simulate QR Scan</button>
            </div>
        </div>

        <!-- Screen 2: Blocker Setup -->
        <div id="screen2" class="screen">
            <div class="card">
                <h2 class="text-center font-bold mb-4" style="font-size: 1.5rem;">Blocker Setup</h2>
                <div class="text-center mb-6">
                    <div id="promptLabel" class="font-bold" style="color: #7c3aed; font-size: 1.25rem;"></div>
                    <div id="drawnCards" class="text-sm"></div>
                </div>
                
                <div class="mb-6">
                    <label class="font-bold mb-4" style="display: block; font-size: 1.1rem;">
                        Bidder: How many cards will you rank?
                    </label>
                    <input type="number" id="bidAmount" min="1" max="10" class="input" placeholder="Enter bid amount (1-10)">
                </div>

                <div class="mb-6">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 class="font-bold">Blocks (<span id="blockCount">0</span>)</h3>
                        <button class="btn btn-red" onclick="addBlock()" style="width: auto;">üö´ Add Block</button>
                    </div>
                    <div id="blocksList"></div>
                </div>

                <div class="text-center">
                    <div id="availableInfo" class="text-sm mb-4"></div>
                    <button class="btn btn-purple" onclick="validateAndContinue()">Continue to Scanning</button>
                </div>
            </div>
        </div>

        <!-- Screen 3: Answer Scanning -->
        <div id="screen3" class="screen">
            <div class="card">
                <h2 class="text-center font-bold mb-4" style="font-size: 1.5rem;">Scan Your Answer Cards</h2>
                <div class="text-center mb-6">
                    <div id="scanPromptLabel" class="font-bold" style="color: #7c3aed; font-size: 1.1rem;"></div>
                    <div id="scanBidInfo" class="text-sm"></div>
                </div>
                
                <div class="info-box">
                    <h3 class="font-bold mb-4">Available Cards:</h3>
                    <div id="availableCards" class="text-sm"></div>
                </div>

                <div class="text-center" style="background: #dbeafe; padding: 30px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 15px;">üì±</div>
                    <p style="font-size: 1.1rem; margin-bottom: 15px; color: #1e40af;">
                        Scan <span id="scanCount"></span> cards in your ranking order
                    </p>
                    <p class="text-sm">
                        (Highest to lowest for: <span id="scanChallenge"></span>)
                    </p>
                </div>

                <button class="btn" onclick="scanAnswerCards()">üì∑ Scan <span id="scanButtonCount"></span> Cards</button>
            </div>
        </div>

        <!-- Screen 4: Reveal Phase -->
        <div id="screen4" class="screen">
            <div class="card">
                <h2 class="text-center font-bold mb-4" style="font-size: 1.5rem;">Reveal Phase</h2>
                <div class="text-center mb-6">
                    <div id="revealPromptLabel" class="font-bold" style="color: #7c3aed; font-size: 1.1rem;"></div>
                </div>

                <div id="revealCards" class="grid"></div>

                <div class="text-center">
                    <button id="revealButton" class="btn btn-green" onclick="revealNextCard()">
                        ‚ñ∂Ô∏è Reveal Next Card (1/?)
                    </button>
                    <button id="resultsButton" class="btn btn-purple" onclick="showResults()" style="display: none;">
                        üéØ See Score for Round
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 5: Results -->
        <div id="screen5" class="screen">
            <div class="card">
                <div class="text-center">
                    <div id="resultIcon" class="result-icon"></div>
                    <h2 id="resultTitle" class="font-bold mb-4" style="font-size: 2rem;"></h2>
                    <div id="resultMessage" class="mb-6" style="font-size: 1.1rem; color: #374151;"></div>
                </div>

                <div class="info-box mb-6">
                    <h3 class="font-bold mb-4">Game Summary:</h3>
                    <div id="gameSummary" class="text-sm"></div>
                </div>

                <button class="btn" onclick="resetGame()">üîÑ New Game</button>
            </div>
        </div>
    </div>

    <script>
        // Game state
        var currentScreen = 1;
        var prompt = null;
        var drawnCards = [];
        var bidAmount = 0;
        var blocks = [];
        var scannedAnswers = [];
        var revealIndex = 0;
        var gameResult = null;
        var failureReason = '';

        // Sample data
        var SAMPLE_DATA = {
            prompts: {
                gdp: { challenge: 'gdp', label: 'Rank by GDP (Highest to Lowest)', order: 'desc' },
                population: { challenge: 'population', label: 'Rank by Population (Highest to Lowest)', order: 'desc' },
                area: { challenge: 'area', label: 'Rank by Area (Largest to Smallest)', order: 'desc' }
            },
            countries: {
                '001': { id: '001', name: 'United States', gdp: 21427700, population: 331002651, area: 9833517 },
                '002': { id: '002', name: 'China', gdp: 14342300, population: 1439323776, area: 9596961 },
                '003': { id: '003', name: 'Japan', gdp: 4937422, population: 126476461, area: 377975 },
                '004': { id: '004', name: 'Germany', gdp: 3846414, population: 83783942, area: 357114 },
                '005': { id: '005', name: 'India', gdp: 2875142, population: 1380004385, area: 3287263 },
                '006': { id: '006', name: 'United Kingdom', gdp: 2829108, population: 67886011, area: 242495 },
                '007': { id: '007', name: 'France', gdp: 2715518, population: 65273511, area: 551695 },
                '008': { id: '008', name: 'Italy', gdp: 2001244, population: 60461826, area: 301340 },
                '009': { id: '009', name: 'Brazil', gdp: 1839758, population: 212559417, area: 8515767 },
                '010': { id: '010', name: 'Canada', gdp: 1736426, population: 37742154, area: 9984670 }
            }
        };

        function showScreen(screenNum) {
            document.querySelectorAll('.screen').forEach(function(screen) {
                screen.classList.remove('active');
            });
            document.getElementById('screen' + screenNum).classList.add('active');
            currentScreen = screenNum;
        }

        function simulateQRScan() {
            var prompts = ['gdp', 'population', 'area'];
            var selectedPrompt = prompts[Math.floor(Math.random() * prompts.length)];
            prompt = SAMPLE_DATA.prompts[selectedPrompt];
            
            // Auto-draw 10 cards
            var allCardIds = Object.keys(SAMPLE_DATA.countries);
            var shuffled = allCardIds.sort(function() { return Math.random() - 0.5; });
            drawnCards = shuffled.slice(0, 10);
            
            updateBlockerScreen();
            showScreen(2);
        }

        function updateBlockerScreen() {
            document.getElementById('promptLabel').textContent = prompt.label;
            var cardNames = drawnCards.map(function(id) {
                return SAMPLE_DATA.countries[id].name;
            }).join(', ');
            document.getElementById('drawnCards').textContent = '10 cards drawn: ' + cardNames;
            updateAvailableInfo();
        }

        function updateAvailableInfo() {
            var unblocked = drawnCards.filter(function(cardId) {
                return !blocks.some(function(block) { return block.cardId === cardId; });
            });
            var text = 'Available for bidding: ' + unblocked.length + ' cards';
            if (blocks.length > 0) {
                text += ' (' + blocks.length + ' blocked)';
            }
            document.getElementById('availableInfo').textContent = text;
            document.getElementById('blockCount').textContent = blocks.length;
            updateBlocksList();
        }

        function updateBlocksList() {
            var blocksList = document.getElementById('blocksList');
            blocksList.innerHTML = '';
            
            blocks.forEach(function(block, index) {
                var country = SAMPLE_DATA.countries[block.cardId];
                var div = document.createElement('div');
                div.className = 'block-item';
                div.innerHTML = 
                    '<span>' + block.cardId + ' - ' + country.name + ' (' + block.multiplier + '√ó multiplier)</span>' +
                    '<button onclick="removeBlock(\'' + block.cardId + '\')" style="background: none; border: none; color: #dc2626; font-weight: bold; font-size: 1.2rem; cursor: pointer;">√ó</button>';
                blocksList.appendChild(div);
            });
        }

        function addBlock() {
            var unblocked = drawnCards.filter(function(cardId) {
                return !blocks.some(function(block) { return block.cardId === cardId; });
            });
            
            if (unblocked.length === 0) {
                alert('No cards available to block!');
                return;
            }
            
            var cardOptions = '<option value="">Select card to block...</option>';
            unblocked.forEach(function(cardId) {
                var country = SAMPLE_DATA.countries[cardId];
                cardOptions += '<option value="' + cardId + '">' + cardId + ' - ' + country.name + '</option>';
            });
            
            var multiplierOptions = '<option value="">Select multiplier...</option>' +
                '<option value="1">1√ó</option>' +
                '<option value="2">2√ó</option>' +
                '<option value="3">3√ó</option>' +
                '<option value="4">4√ó</option>';
            
            var overlay = document.createElement('div');
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;';
            
            var dialog = document.createElement('div');
            dialog.style.cssText = 'background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); max-width: 400px; width: 90%;';
            
            dialog.innerHTML = 
                '<h3 style="margin: 0 0 20px 0; color: #7c3aed; font-size: 1.3rem;">Add Block</h3>' +
                '<select id="blockCardSelect" style="width: 100%; padding: 10px; margin-bottom: 15px; border: 2px solid #e5e7eb; border-radius: 6px;">' + cardOptions + '</select>' +
                '<select id="blockMultiplierSelect" style="width: 100%; padding: 10px; margin-bottom: 20px; border: 2px solid #e5e7eb; border-radius: 6px;">' + multiplierOptions + '</select>' +
                '<div style="display: flex; gap: 10px;">' +
                    '<button onclick="closeBlockDialog()" style="flex: 1; background: #ef4444; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer;">Cancel</button>' +
                    '<button onclick="confirmAddBlock()" style="flex: 1; background: #7c3aed; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer;">Add Block</button>' +
                '</div>';
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            window.currentBlockDialog = overlay;
        }

        function closeBlockDialog() {
            if (window.currentBlockDialog) {
                document.body.removeChild(window.currentBlockDialog);
                window.currentBlockDialog = null;
            }
        }

        function confirmAddBlock() {
            var cardId = document.getElementById('blockCardSelect').value;
            var multiplier = parseInt(document.getElementById('blockMultiplierSelect').value);
            
            if (cardId && multiplier) {
                blocks.push({ cardId: cardId, multiplier: multiplier });
                updateAvailableInfo();
                closeBlockDialog();
            } else {
                alert('Please select both a card and multiplier');
            }
        }

        function removeBlock(cardId) {
            blocks = blocks.filter(function(block) {
                return block.cardId !== cardId;
            });
            updateAvailableInfo();
        }

        function validateAndContinue() {
            var bid = parseInt(document.getElementById('bidAmount').value);
            if (!bid || bid < 1 || bid > 10) {
                alert('Please enter a bid amount between 1 and 10');
                return;
            }
            
            var unblocked = drawnCards.filter(function(cardId) {
                return !blocks.some(function(block) { return block.cardId === cardId; });
            });
            
            if (bid > unblocked.length) {
                alert('You can only bid up to ' + unblocked.length + ' cards (' + blocks.length + ' cards are blocked)');
                return;
            }
            
            bidAmount = bid;
            updateScanScreen();
            showScreen(3);
        }

        function updateScanScreen() {
            document.getElementById('scanPromptLabel').textContent = prompt.label;
            document.getElementById('scanBidInfo').textContent = 'Bid: ' + bidAmount + ' cards';
            document.getElementById('scanCount').textContent = bidAmount;
            document.getElementById('scanButtonCount').textContent = bidAmount;
            document.getElementById('scanChallenge').textContent = prompt.label.toLowerCase();
            
            var unblocked = drawnCards.filter(function(cardId) {
                return !blocks.some(function(block) { return block.cardId === cardId; });
            });
            
            var cardsList = unblocked.map(function(cardId) {
                return cardId + ' - ' + SAMPLE_DATA.countries[cardId].name;
            }).join(', ');
            
            document.getElementById('availableCards').textContent = cardsList;
        }

        function scanAnswerCards() {
            var unblocked = drawnCards.filter(function(cardId) {
                return !blocks.some(function(block) { return block.cardId === cardId; });
            });
            
            // Simulate scanning the bid amount of cards
            var shuffledUnblocked = unblocked.sort(function() { return Math.random() - 0.5; });
            scannedAnswers = shuffledUnblocked.slice(0, bidAmount);
            
            revealIndex = 0;
            updateRevealScreen();
            showScreen(4);
        }

        function updateRevealScreen() {
            document.getElementById('revealPromptLabel').textContent = prompt.label;
            var revealCards = document.getElementById('revealCards');
            revealCards.innerHTML = '';
            
            scannedAnswers.forEach(function(cardId, index) {
                var card = createRevealCard(cardId, index);
                revealCards.appendChild(card);
            });
            
            updateRevealButton();
        }

        function createRevealCard(cardId, index) {
            var country = SAMPLE_DATA.countries[cardId];
            var block = blocks.find(function(b) { return b.cardId === cardId; });
            var isRevealed = index < revealIndex;
            var isCurrentlyRevealing = index === revealIndex;
            var isBlocked = !!block;
            
            var div = document.createElement('div');
            div.className = 'reveal-card';
            
            if (isRevealed) {
                div.className += isBlocked ? ' revealed-blocked' : ' revealed-correct';
            } else if (isCurrentlyRevealing) {
                div.className += ' current';
            } else {
                div.className += ' unrevealed';
            }
            
            var content = '<div style="font-size: 1.1rem; font-weight: bold;">Position ' + (index + 1) + '</div>';
            
            if (isRevealed || isCurrentlyRevealing) {
                content += '<div style="font-size: 1.5rem; font-weight: bold; margin-top: 10px;">';
                content += cardId + ' - ' + country.name;
                if (isBlocked) {
                    content += '<span style="color: #dc2626; margin-left: 10px;">üö´ BLOCKED (' + block.multiplier + '√ó)</span>';
                }
                content += '</div>';
                
                var statValue = '';
                if (prompt.challenge === 'gdp') {
                    statValue = 'GDP: $' + country.gdp.toLocaleString() + 'M';
                } else if (prompt.challenge === 'population') {
                    statValue = 'Pop: ' + country.population.toLocaleString();
                } else if (prompt.challenge === 'area') {
                    statValue = 'Area: ' + country.area.toLocaleString() + ' km¬≤';
                }
                content += '<div style="font-size: 0.9rem; color: #6b7280; margin-top: 5px;">' + statValue + '</div>';
            } else {
                content += '<div style="font-size: 1.5rem; font-weight: bold; margin-top: 10px;">???</div>';
            }
            
            div.innerHTML = content;
            return div;
        }

        function updateRevealButton() {
            var revealButton = document.getElementById('revealButton');
            var resultsButton = document.getElementById('resultsButton');
            
            if (revealIndex < scannedAnswers.length) {
                revealButton.style.display = 'block';
                resultsButton.style.display = 'none';
                revealButton.innerHTML = '‚ñ∂Ô∏è Reveal Next Card (' + (revealIndex + 1) + '/' + scannedAnswers.length + ')';
            } else {
                revealButton.style.display = 'none';
                resultsButton.style.display = 'block';
            }
        }

        function revealNextCard() {
            var currentCard = scannedAnswers[revealIndex];
            var currentCountry = SAMPLE_DATA.countries[currentCard];
            
            // Check if this card is blocked
            var block = blocks.find(function(b) { return b.cardId === currentCard; });
            if (block) {
                // Hit a block - bidder loses immediately
                var blockerPoints = bidAmount * block.multiplier;
                gameResult = 'blockers_win';
                failureReason = 'Hit blocked card: ' + currentCountry.name + ' (' + block.multiplier + '√ó multiplier). Blockers earn ' + blockerPoints + ' points!';
                showResults();
                return;
            }

            // CRITICAL FIX: First card cannot be wrong in ordering
            if (revealIndex === 0) {
                // First card is always correct (no comparison possible)
                revealIndex = 1;
                updateRevealScreen();
                return;
            }

            // For subsequent cards, check ordering
            var previousCard = scannedAnswers[revealIndex - 1];
            var previousCountry = SAMPLE_DATA.countries[previousCard];
            
            var metric = prompt.challenge;
            var currentValue = currentCountry[metric];
            var previousValue = previousCountry[metric];
            
            // Check if order is correct (should be descending for all our metrics)
            if (currentValue > previousValue) {
                // Wrong order - bidder loses
                gameResult = 'blockers_win';
                failureReason = 'Wrong order! ' + currentCountry.name + ' (' + currentValue.toLocaleString() + ') has higher ' + metric + ' than ' + previousCountry.name + ' (' + previousValue.toLocaleString() + '). Blockers win ' + bidAmount + ' points!';
                showResults();
                return;
            }

            // Correct so far
            var nextIndex = revealIndex + 1;
            if (nextIndex >= scannedAnswers.length) {
                // All cards revealed successfully - bidder wins
                var bidderPoints = bidAmount + (blocks.length * 2); // Bonus for evading blocks
                gameResult = 'bidder_wins';
                failureReason = 'Perfect ranking! Bidder earns ' + bidderPoints + ' points (' + bidAmount + ' base + ' + (blocks.length * 2) + ' block evasion bonus)!';
                showResults();
            } else {
                revealIndex = nextIndex;
                updateRevealScreen();
            }
        }

        function showResults() {
            document.getElementById('resultIcon').textContent = gameResult === 'bidder_wins' ? '‚úÖ' : '‚ùå';
            document.getElementById('resultTitle').textContent = gameResult === 'bidder_wins' ? 'Bidder Wins!' : 'Blockers Win!';
            document.getElementById('resultMessage').textContent = failureReason;
            
            var summary = 'Challenge: ' + prompt.label + '<br>' +
                         'Bid Amount: ' + bidAmount + ' cards<br>' +
                         'Blocks Set: ' + blocks.length + '<br>' +
                         'Cards Revealed: ' + revealIndex + ' of ' + scannedAnswers.length;
            
            document.getElementById('gameSummary').innerHTML = summary;
            showScreen(5);
        }

        function resetGame() {
            currentScreen = 1;
            prompt = null;
            drawnCards = [];
            bidAmount = 0;
            blocks = [];
            scannedAnswers = [];
            revealIndex = 0;
            gameResult = null;
            failureReason = '';
            
            document.getElementById('bidAmount').value = '';
            showScreen(1);
        }
    </script>
</body>
</html>
